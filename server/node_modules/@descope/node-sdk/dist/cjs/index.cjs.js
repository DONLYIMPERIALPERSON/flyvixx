"use strict";var e=require("tslib"),s=require("@descope/core-js-sdk"),t=require("jose"),o=require("cross-fetch");function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=a(s);var n;null!==(n=globalThis.Headers)&&void 0!==n||(globalThis.Headers=o.Headers);const i=(...e)=>(e.forEach((e=>{var s,t;e&&"object"==typeof e&&(null!==(s=(t=e).highWaterMark)&&void 0!==s||(t.highWaterMark=31457280))})),o.fetch(...e)),p=(e,s)=>{const t=null==e?void 0:e.match(RegExp(`(?:^|[;,]\\s*)${s}=([^;]*)`));return t?t[1]:null},m=s=>async(...t)=>{var o,a,r;const n=await s(...t);if(!n.data)return n;let i=n.data,{refreshJwt:m}=i,d=e.__rest(i,["refreshJwt"]);const l=[];var c;return m?l.push(`${"DSR"}=${m}; Domain=${(null==(c=d)?void 0:c.cookieDomain)||""}; Max-Age=${(null==c?void 0:c.cookieMaxAge)||""}; Path=${(null==c?void 0:c.cookiePath)||"/"}; HttpOnly; SameSite=Strict`):(null===(o=n.response)||void 0===o?void 0:o.headers.get("set-cookie"))&&(m=p(null===(a=n.response)||void 0===a?void 0:a.headers.get("set-cookie"),"DSR"),l.push(null===(r=n.response)||void 0===r?void 0:r.headers.get("set-cookie"))),Object.assign(Object.assign({},n),{data:Object.assign(Object.assign({},n.data),{refreshJwt:m,cookies:l})})};function d(e,s,t){var o,a;const r=t?null===(a=null===(o=e.token.tenants)||void 0===o?void 0:o[t])||void 0===a?void 0:a[s]:e.token[s];return Array.isArray(r)?r:[]}function l(e,s){var t;return!!(null===(t=e.token.tenants)||void 0===t?void 0:t[s])}var c={create:"/v1/mgmt/user/create",createTestUser:"/v1/mgmt/user/create/test",createBatch:"/v1/mgmt/user/create/batch",update:"/v1/mgmt/user/update",patch:"/v1/mgmt/user/patch",patchBatch:"/v1/mgmt/user/patch/batch",delete:"/v1/mgmt/user/delete",deleteBatch:"/v1/mgmt/user/delete/batch",deleteAllTestUsers:"/v1/mgmt/user/test/delete/all",load:"/v1/mgmt/user",logout:"/v1/mgmt/user/logout",loadUsers:"/v1/mgmt/users/load",search:"/v2/mgmt/user/search",searchTestUsers:"/v2/mgmt/user/search/test",getProviderToken:"/v1/mgmt/user/provider/token",updateStatus:"/v1/mgmt/user/update/status",updateLoginId:"/v1/mgmt/user/update/loginid",updateEmail:"/v1/mgmt/user/update/email",updatePhone:"/v1/mgmt/user/update/phone",updateDisplayName:"/v1/mgmt/user/update/name",updatePicture:"/v1/mgmt/user/update/picture",updateCustomAttribute:"/v1/mgmt/user/update/customAttribute",setRole:"/v1/mgmt/user/update/role/set",addRole:"/v2/mgmt/user/update/role/add",removeRole:"/v1/mgmt/user/update/role/remove",setSSOApps:"/v1/mgmt/user/update/ssoapp/set",addSSOApps:"/v1/mgmt/user/update/ssoapp/add",removeSSOApps:"/v1/mgmt/user/update/ssoapp/remove",addTenant:"/v1/mgmt/user/update/tenant/add",removeTenant:"/v1/mgmt/user/update/tenant/remove",setPassword:"/v1/mgmt/user/password/set",setTemporaryPassword:"/v1/mgmt/user/password/set/temporary",setActivePassword:"/v1/mgmt/user/password/set/active",expirePassword:"/v1/mgmt/user/password/expire",removeAllPasskeys:"/v1/mgmt/user/passkeys/delete",removeTOTPSeed:"/v1/mgmt/user/totp/delete",generateOTPForTest:"/v1/mgmt/tests/generate/otp",generateMagicLinkForTest:"/v1/mgmt/tests/generate/magiclink",generateEnchantedLinkForTest:"/v1/mgmt/tests/generate/enchantedlink",generateEmbeddedLink:"/v1/mgmt/user/signin/embeddedlink",generateSignUpEmbeddedLink:"/v1/mgmt/user/signup/embeddedlink",history:"/v1/mgmt/user/history"},u={updateName:"/v1/mgmt/project/update/name",updateTags:"/v1/mgmt/project/update/tags",clone:"/v1/mgmt/project/clone",projectsList:"/v1/mgmt/projects/list",exportSnapshot:"/v1/mgmt/project/snapshot/export",importSnapshot:"/v1/mgmt/project/snapshot/import",validateSnapshot:"/v1/mgmt/project/snapshot/validate"},g={create:"/v1/mgmt/accesskey/create",load:"/v1/mgmt/accesskey",search:"/v1/mgmt/accesskey/search",update:"/v1/mgmt/accesskey/update",deactivate:"/v1/mgmt/accesskey/deactivate",activate:"/v1/mgmt/accesskey/activate",delete:"/v1/mgmt/accesskey/delete"},v={create:"/v1/mgmt/tenant/create",update:"/v1/mgmt/tenant/update",delete:"/v1/mgmt/tenant/delete",load:"/v1/mgmt/tenant",settings:"/v1/mgmt/tenant/settings",loadAll:"/v1/mgmt/tenant/all",searchAll:"/v1/mgmt/tenant/search",generateSSOConfigurationLink:"/v2/mgmt/tenant/adminlinks/sso/generate"},f={oidcCreate:"/v1/mgmt/sso/idp/app/oidc/create",samlCreate:"/v1/mgmt/sso/idp/app/saml/create",oidcUpdate:"/v1/mgmt/sso/idp/app/oidc/update",samlUpdate:"/v1/mgmt/sso/idp/app/saml/update",delete:"/v1/mgmt/sso/idp/app/delete",load:"/v1/mgmt/sso/idp/app/load",loadAll:"/v1/mgmt/sso/idp/apps/load"},h={create:"/v1/mgmt/thirdparty/app/create",update:"/v1/mgmt/thirdparty/app/update",patch:"/v1/mgmt/thirdparty/app/patch",delete:"/v1/mgmt/thirdparty/app/delete",load:"/v1/mgmt/thirdparty/app/load",loadAll:"/v1/mgmt/thirdparty/apps/load",secret:"/v1/mgmt/thirdparty/app/secret",rotate:"/v1/mgmt/thirdparty/app/rotate"},R={delete:"/v1/mgmt/thirdparty/consents/delete",search:"/v1/mgmt/thirdparty/consents/search"},y={create:"/v1/mgmt/outbound/app/create",update:"/v1/mgmt/outbound/app/update",delete:"/v1/mgmt/outbound/app/delete",load:"/v1/mgmt/outbound/app",loadAll:"/v1/mgmt/outbound/apps",fetchToken:"/v1/mgmt/outbound/app/user/token/latest",fetchTokenByScopes:"/v1/mgmt/outbound/app/user/token",fetchTenantToken:"/v1/mgmt/outbound/app/tenant/token/latest",fetchTenantTokenByScopes:"/v1/mgmt/outbound/app/tenant/token",deleteUserTokens:"/v1/mgmt/outbound/user/tokens",deleteTokenById:"/v1/mgmt/outbound/token"},I={settings:"/v1/mgmt/sso/settings",settingsNew:"/v1/mgmt/sso/settings/new",metadata:"/v1/mgmt/sso/metadata",mapping:"/v1/mgmt/sso/mapping",settingsv2:"/v2/mgmt/sso/settings",settingsAllV2:"/v2/mgmt/sso/settings/all",oidc:{configure:"/v1/mgmt/sso/oidc"},saml:{configure:"/v1/mgmt/sso/saml",metadata:"/v1/mgmt/sso/saml/metadata"}},b={update:"/v1/mgmt/jwt/update",impersonate:"/v1/mgmt/impersonate",stopImpersonation:"/v1/mgmt/stop/impersonation",signIn:"/v1/mgmt/auth/signin",signUp:"/v1/mgmt/auth/signup",signUpOrIn:"/v1/mgmt/auth/signup-in",anonymous:"/v1/mgmt/auth/anonymous",clientAssertion:"/v1/mgmt/token/clientassertion"},k={settings:"/v1/mgmt/password/settings"},A={create:"/v1/mgmt/permission/create",update:"/v1/mgmt/permission/update",delete:"/v1/mgmt/permission/delete",loadAll:"/v1/mgmt/permission/all"},O={create:"/v1/mgmt/role/create",update:"/v1/mgmt/role/update",delete:"/v1/mgmt/role/delete",loadAll:"/v1/mgmt/role/all",search:"/v1/mgmt/role/search"},S={list:"/v1/mgmt/flow/list",delete:"/v1/mgmt/flow/delete",export:"/v1/mgmt/flow/export",import:"/v1/mgmt/flow/import",run:"/v1/mgmt/flow/run"},T={export:"/v1/mgmt/theme/export",import:"/v1/mgmt/theme/import"},w={loadAllGroups:"/v1/mgmt/group/all",loadAllGroupsForMember:"/v1/mgmt/group/member/all",loadAllGroupMembers:"/v1/mgmt/group/members"},j={search:"/v1/mgmt/audit/search",createEvent:"/v1/mgmt/audit/event"},N={schemaSave:"/v1/mgmt/authz/schema/save",schemaDelete:"/v1/mgmt/authz/schema/delete",schemaLoad:"/v1/mgmt/authz/schema/load",nsSave:"/v1/mgmt/authz/ns/save",nsDelete:"/v1/mgmt/authz/ns/delete",rdSave:"/v1/mgmt/authz/rd/save",rdDelete:"/v1/mgmt/authz/rd/delete",reCreate:"/v1/mgmt/authz/re/create",reDelete:"/v1/mgmt/authz/re/delete",reDeleteResources:"/v1/mgmt/authz/re/deleteresources",reDeleteResourceRelationsForResources:"/v1/mgmt/authz/re/deleteresourcesrelations",hasRelations:"/v1/mgmt/authz/re/has",who:"/v1/mgmt/authz/re/who",resource:"/v1/mgmt/authz/re/resource",targets:"/v1/mgmt/authz/re/targets",targetAll:"/v1/mgmt/authz/re/targetall",targetWithRelation:"/v1/mgmt/authz/re/targetwithrelation",getModified:"/v1/mgmt/authz/getmodified"},P={schema:"/v1/mgmt/fga/schema",relations:"/v1/mgmt/fga/relations",deleteRelations:"/v1/mgmt/fga/relations/delete",check:"/v1/mgmt/fga/check",resourcesLoad:"/v1/mgmt/fga/resources/load",resourcesSave:"/v1/mgmt/fga/resources/save"},U={create:"/v1/mgmt/descoper",update:"/v1/mgmt/descoper",get:"/v1/mgmt/descoper",delete:"/v1/mgmt/descoper",list:"/v1/mgmt/descoper/list"},E={create:"/v1/mgmt/managementkey",update:"/v1/mgmt/managementkey",load:"/v1/mgmt/managementkey",delete:"/v1/mgmt/managementkey/delete",search:"/v1/mgmt/managementkey/search"};function M(s){return s.map((s=>{var{roles:t}=s,o=e.__rest(s,["roles"]);return Object.assign(Object.assign({},o),{roleNames:t})}))}const x=e=>{function t(e,s){const t={loginId:e};return void 0!==s.email&&(t.email=s.email),void 0!==s.phone&&(t.phone=s.phone),void 0!==s.displayName&&(t.displayName=s.displayName),void 0!==s.givenName&&(t.givenName=s.givenName),void 0!==s.middleName&&(t.middleName=s.middleName),void 0!==s.familyName&&(t.familyName=s.familyName),void 0!==s.roles&&(t.roleNames=s.roles),void 0!==s.userTenants&&(t.userTenants=s.userTenants),void 0!==s.customAttributes&&(t.customAttributes=s.customAttributes),void 0!==s.picture&&(t.picture=s.picture),void 0!==s.verifiedEmail&&(t.verifiedEmail=s.verifiedEmail),void 0!==s.verifiedPhone&&(t.verifiedPhone=s.verifiedPhone),void 0!==s.ssoAppIds&&(t.ssoAppIds=s.ssoAppIds),void 0!==s.scim&&(t.scim=s.scim),void 0!==s.status&&(t.status=s.status),t}return{create:function(t,o,a,r,n,i,p,m,d,l,u,g,v,f){const h="string"==typeof o?{loginId:t,email:o,phone:a,displayName:r,givenName:u,middleName:g,familyName:v,roleNames:n,userTenants:i,customAttributes:p,picture:m,verifiedEmail:d,verifiedPhone:l,additionalLoginIds:f}:Object.assign(Object.assign({loginId:t},o),{roleNames:null==o?void 0:o.roles,roles:void 0});return s.transformResponse(e.post(c.create,h),(e=>e.user))},createTestUser:function(t,o,a,r,n,i,p,m,d,l,u,g,v,f){const h="string"==typeof o?{loginId:t,email:o,phone:a,displayName:r,givenName:u,middleName:g,familyName:v,roleNames:n,userTenants:i,customAttributes:p,picture:m,verifiedEmail:d,verifiedPhone:l,additionalLoginIds:f,test:!0}:Object.assign(Object.assign({loginId:t},o),{roleNames:null==o?void 0:o.roles,roles:void 0,test:!0});return s.transformResponse(e.post(c.createTestUser,h),(e=>e.user))},invite:function(t,o,a,r,n,i,p,m,d,l,u,g,v,f,h,R,y,I){const b="string"==typeof o?{loginId:t,email:o,phone:a,displayName:r,givenName:f,middleName:h,familyName:R,roleNames:n,userTenants:i,invite:!0,customAttributes:p,picture:m,verifiedEmail:d,verifiedPhone:l,inviteUrl:u,sendMail:g,sendSMS:v,additionalLoginIds:y,templateId:I}:Object.assign(Object.assign({loginId:t},o),{roleNames:null==o?void 0:o.roles,roles:void 0,invite:!0});return s.transformResponse(e.post(c.create,b),(e=>e.user))},inviteBatch:(t,o,a,r,n,i)=>s.transformResponse(e.post(c.createBatch,{users:M(t),invite:!0,inviteUrl:o,sendMail:a,sendSMS:r,templateOptions:n,templateId:i}),(e=>e)),createBatch:t=>s.transformResponse(e.post(c.createBatch,{users:M(t)}),(e=>e)),deleteBatch:t=>s.transformResponse(e.post(c.deleteBatch,{userIds:t})),update:function(t,o,a,r,n,i,p,m,d,l,u,g,v,f){const h="string"==typeof o?{loginId:t,email:o,phone:a,displayName:r,givenName:u,middleName:g,familyName:v,roleNames:n,userTenants:i,customAttributes:p,picture:m,verifiedEmail:d,verifiedPhone:l,additionalLoginIds:f}:Object.assign(Object.assign({loginId:t},o),{roleNames:null==o?void 0:o.roles,roles:void 0});return s.transformResponse(e.post(c.update,h),(e=>e.user))},patch:function(o,a){const r=t(o,a);return s.transformResponse(e.patch(c.patch,r),(e=>e.user))},patchBatch:function(o){const a={users:o.map((e=>t(e.loginId,e)))};return s.transformResponse(e.patch(c.patchBatch,a),(e=>e))},delete:t=>s.transformResponse(e.post(c.delete,{loginId:t})),deleteByUserId:t=>s.transformResponse(e.post(c.delete,{userId:t})),deleteAllTestUsers:()=>s.transformResponse(e.delete(c.deleteAllTestUsers)),load:t=>s.transformResponse(e.get(c.load,{queryParams:{loginId:t}}),(e=>e.user)),loadByUserId:t=>s.transformResponse(e.get(c.load,{queryParams:{userId:t}}),(e=>e.user)),logoutUser:t=>s.transformResponse(e.post(c.logout,{loginId:t})),logoutUserByUserId:t=>s.transformResponse(e.post(c.logout,{userId:t})),loadUsers:(t,o)=>s.transformResponse(e.post(c.loadUsers,{userIds:t,includeInvalidUsers:o}),(e=>e.users)),searchAll:(t,o,a,r,n,i,p,m,d,l)=>s.transformResponse(e.post(c.search,{tenantIds:t,roleNames:o,limit:a,page:r,testUsersOnly:n,withTestUser:i,customAttributes:p,statuses:m,emails:d,phones:l}),(e=>e.users)),searchTestUsers:t=>s.transformResponse(e.post(c.searchTestUsers,Object.assign(Object.assign({},t),{withTestUser:!0,testUsersOnly:!0,roleNames:t.roles,roles:void 0})),(e=>e.users)),search:t=>s.transformResponse(e.post(c.search,Object.assign(Object.assign({},t),{roleNames:t.roles,roles:void 0})),(e=>e.users)),getProviderToken:(t,o,a)=>s.transformResponse(e.get(c.getProviderToken,{queryParams:{loginId:t,provider:o,withRefreshToken:(null==a?void 0:a.withRefreshToken)?"true":"false",forceRefresh:(null==a?void 0:a.forceRefresh)?"true":"false"}}),(e=>e)),activate:t=>s.transformResponse(e.post(c.updateStatus,{loginId:t,status:"enabled"}),(e=>e.user)),deactivate:t=>s.transformResponse(e.post(c.updateStatus,{loginId:t,status:"disabled"}),(e=>e.user)),updateLoginId:(t,o)=>s.transformResponse(e.post(c.updateLoginId,{loginId:t,newLoginId:o}),(e=>e.user)),updateEmail:(t,o,a,r)=>s.transformResponse(e.post(c.updateEmail,{loginId:t,email:o,verified:a,failOnConflict:r}),(e=>e.user)),updatePhone:(t,o,a,r)=>s.transformResponse(e.post(c.updatePhone,{loginId:t,phone:o,verified:a,failOnConflict:r}),(e=>e.user)),updateDisplayName:(t,o,a,r,n)=>s.transformResponse(e.post(c.updateDisplayName,{loginId:t,displayName:o,givenName:a,middleName:r,familyName:n}),(e=>e.user)),updatePicture:(t,o)=>s.transformResponse(e.post(c.updatePicture,{loginId:t,picture:o}),(e=>e.user)),updateCustomAttribute:(t,o,a)=>s.transformResponse(e.post(c.updateCustomAttribute,{loginId:t,attributeKey:o,attributeValue:a}),(e=>e.user)),setRoles:(t,o)=>s.transformResponse(e.post(c.setRole,{loginId:t,roleNames:o}),(e=>e.user)),addRoles:(t,o)=>s.transformResponse(e.post(c.addRole,{loginId:t,roleNames:o}),(e=>e.user)),removeRoles:(t,o)=>s.transformResponse(e.post(c.removeRole,{loginId:t,roleNames:o}),(e=>e.user)),addTenant:(t,o)=>s.transformResponse(e.post(c.addTenant,{loginId:t,tenantId:o}),(e=>e.user)),removeTenant:(t,o)=>s.transformResponse(e.post(c.removeTenant,{loginId:t,tenantId:o}),(e=>e.user)),setTenantRoles:(t,o,a)=>s.transformResponse(e.post(c.setRole,{loginId:t,tenantId:o,roleNames:a}),(e=>e.user)),addTenantRoles:(t,o,a)=>s.transformResponse(e.post(c.addRole,{loginId:t,tenantId:o,roleNames:a}),(e=>e.user)),removeTenantRoles:(t,o,a)=>s.transformResponse(e.post(c.removeRole,{loginId:t,tenantId:o,roleNames:a}),(e=>e.user)),addSSOapps:(t,o)=>s.transformResponse(e.post(c.addSSOApps,{loginId:t,ssoAppIds:o}),(e=>e.user)),setSSOapps:(t,o)=>s.transformResponse(e.post(c.setSSOApps,{loginId:t,ssoAppIds:o}),(e=>e.user)),removeSSOapps:(t,o)=>s.transformResponse(e.post(c.removeSSOApps,{loginId:t,ssoAppIds:o}),(e=>e.user)),generateOTPForTestUser:(t,o,a)=>s.transformResponse(e.post(c.generateOTPForTest,{deliveryMethod:t,loginId:o,loginOptions:a}),(e=>e)),generateMagicLinkForTestUser:(t,o,a,r)=>s.transformResponse(e.post(c.generateMagicLinkForTest,{deliveryMethod:t,loginId:o,URI:a,loginOptions:r}),(e=>e)),generateEnchantedLinkForTestUser:(t,o,a)=>s.transformResponse(e.post(c.generateEnchantedLinkForTest,{loginId:t,URI:o,loginOptions:a}),(e=>e)),generateEmbeddedLink:(t,o,a)=>s.transformResponse(e.post(c.generateEmbeddedLink,{loginId:t,customClaims:o,timeout:a}),(e=>e)),generateSignUpEmbeddedLink:(t,o,a,r,n,i)=>s.transformResponse(e.post(c.generateSignUpEmbeddedLink,{loginId:t,user:o,emailVerified:a,phoneVerified:r,loginOptions:n,timeout:i}),(e=>e)),setTemporaryPassword:(t,o)=>s.transformResponse(e.post(c.setTemporaryPassword,{loginId:t,password:o}),(e=>e)),setActivePassword:(t,o)=>s.transformResponse(e.post(c.setActivePassword,{loginId:t,password:o}),(e=>e)),setPassword:(t,o)=>s.transformResponse(e.post(c.setPassword,{loginId:t,password:o}),(e=>e)),expirePassword:t=>s.transformResponse(e.post(c.expirePassword,{loginId:t}),(e=>e)),removeAllPasskeys:t=>s.transformResponse(e.post(c.removeAllPasskeys,{loginId:t}),(e=>e)),removeTOTPSeed:t=>s.transformResponse(e.post(c.removeTOTPSeed,{loginId:t}),(e=>e)),history:t=>s.transformResponse(e.post(c.history,t),(e=>e))}},C=e=>({create:(t,o,a,r,n,i)=>s.transformResponse(e.post(v.create,{name:t,selfProvisioningDomains:o,customAttributes:a,enforceSSO:r,disabled:n,parent:i})),createWithId:(t,o,a,r,n,i,p)=>s.transformResponse(e.post(v.create,{id:t,name:o,selfProvisioningDomains:a,customAttributes:r,enforceSSO:n,disabled:i,parent:p})),update:(t,o,a,r,n,i)=>s.transformResponse(e.post(v.update,{id:t,name:o,selfProvisioningDomains:a,customAttributes:r,enforceSSO:n,disabled:i})),delete:(t,o)=>s.transformResponse(e.post(v.delete,{id:t,cascade:o})),load:t=>s.transformResponse(e.get(v.load,{queryParams:{id:t}}),(e=>e)),loadAll:()=>s.transformResponse(e.get(v.loadAll,{}),(e=>e.tenants)),searchAll:(t,o,a,r,n)=>s.transformResponse(e.post(v.searchAll,{tenantIds:t,tenantNames:o,tenantSelfProvisioningDomains:a,customAttributes:r,parentTenantId:n}),(e=>e.tenants)),getSettings:t=>s.transformResponse(e.get(v.settings,{queryParams:{id:t}}),(e=>e)),configureSettings:(t,o)=>s.transformResponse(e.post(v.settings,Object.assign(Object.assign({},o),{tenantId:t}),{})),generateSSOConfigurationLink:(t,o,a,r,n)=>s.transformResponse(e.post(v.generateSSOConfigurationLink,{tenantId:t,expireTime:o,ssoId:a,email:r,templateId:n},{}),(e=>e))}),D=e=>({update:(t,o,a)=>s.transformResponse(e.post(b.update,{jwt:t,customClaims:o,refreshDuration:a})),impersonate:(t,o,a,r,n,i)=>s.transformResponse(e.post(b.impersonate,{impersonatorId:t,loginId:o,validateConsent:a,customClaims:r,selectedTenant:n,refreshDuration:i})),stopImpersonation:(t,o,a,r)=>s.transformResponse(e.post(b.stopImpersonation,{jwt:t,customClaims:o,selectedTenant:a,refreshDuration:r})),signIn:(t,o)=>s.transformResponse(e.post(b.signIn,Object.assign({loginId:t},o))),signUp:(t,o,a)=>s.transformResponse(e.post(b.signUp,Object.assign({loginId:t,user:o},a))),signUpOrIn:(t,o,a)=>s.transformResponse(e.post(b.signUpOrIn,Object.assign({loginId:t,user:o},a))),anonymous:(t,o,a)=>s.transformResponse(e.post(b.anonymous,{customClaims:t,selectedTenant:o,refreshDuration:a})),generateClientAssertionJwt:(t,o,a,r,n,i)=>s.transformResponse(e.post(b.clientAssertion,{issuer:t,subject:o,audience:a,expiresIn:r,flattenAudience:n,algorithm:i}))}),L=e=>({create:(t,o)=>s.transformResponse(e.post(A.create,{name:t,description:o})),update:(t,o,a)=>s.transformResponse(e.post(A.update,{name:t,newName:o,description:a})),delete:t=>s.transformResponse(e.post(A.delete,{name:t})),loadAll:()=>s.transformResponse(e.get(A.loadAll,{}),(e=>e.permissions))}),q=e=>({create:(t,o,a,r,n)=>s.transformResponse(e.post(O.create,{name:t,description:o,permissionNames:a,tenantId:r,default:n})),update:(t,o,a,r,n,i)=>s.transformResponse(e.post(O.update,{name:t,newName:o,description:a,permissionNames:r,tenantId:n,default:i})),delete:(t,o)=>s.transformResponse(e.post(O.delete,{name:t,tenantId:o})),loadAll:()=>s.transformResponse(e.get(O.loadAll,{}),(e=>e.roles)),search:t=>s.transformResponse(e.post(O.search,t,{}),(e=>e.roles))}),B=e=>({loadAllGroups:t=>s.transformResponse(e.post(w.loadAllGroups,{tenantId:t})),loadAllGroupsForMember:(t,o,a)=>s.transformResponse(e.post(w.loadAllGroupsForMember,{tenantId:t,loginIds:a,userIds:o})),loadAllGroupMembers:(t,o)=>s.transformResponse(e.post(w.loadAllGroupMembers,{tenantId:t,groupId:o}))});function F(e){var s,t;const o=e;return o.oidc&&(o.oidc=Object.assign(Object.assign({},o.oidc),{attributeMapping:o.oidc.userAttrMapping}),delete o.oidc.userAttrMapping),(null===(s=o.saml)||void 0===s?void 0:s.groupsMapping)&&(o.saml.groupsMapping=null===(t=o.saml)||void 0===t?void 0:t.groupsMapping.map((e=>{const s=e;return s.roleName=s.role.name,delete s.role,s}))),o}const $=e=>({getSettings:t=>s.transformResponse(e.get(I.settings,{queryParams:{tenantId:t}}),(e=>e)),newSettings:(t,o,a)=>s.transformResponse(e.post(I.settingsNew,Object.assign(Object.assign({tenantId:t},o?{ssoId:o}:{}),{displayName:a})),(e=>F(e))),deleteSettings:(t,o)=>s.transformResponse(e.delete(I.settings,{queryParams:Object.assign({tenantId:t},o?{ssoId:o}:{})})),configureSettings:(t,o,a,r,n,i)=>s.transformResponse(e.post(I.settings,{tenantId:t,idpURL:o,entityId:r,idpCert:a,redirectURL:n,domains:i})),configureMetadata:(t,o,a,r)=>s.transformResponse(e.post(I.metadata,{tenantId:t,idpMetadataURL:o,redirectURL:a,domains:r})),configureMapping:(t,o,a)=>s.transformResponse(e.post(I.mapping,{tenantId:t,roleMappings:o,attributeMapping:a})),configureOIDCSettings:(t,o,a,r)=>{const n=Object.assign(Object.assign({},o),{userAttrMapping:o.attributeMapping});return delete n.attributeMapping,s.transformResponse(e.post(I.oidc.configure,Object.assign({tenantId:t,settings:n,domains:a},r?{ssoId:r}:{})))},configureSAMLSettings:(t,o,a,r,n)=>s.transformResponse(e.post(I.saml.configure,Object.assign({tenantId:t,settings:o,redirectUrl:a,domains:r},n?{ssoId:n}:{}))),configureSAMLByMetadata:(t,o,a,r,n)=>s.transformResponse(e.post(I.saml.metadata,Object.assign({tenantId:t,settings:o,redirectUrl:a,domains:r},n?{ssoId:n}:{}))),loadSettings:(t,o)=>s.transformResponse(e.get(I.settingsv2,{queryParams:Object.assign({tenantId:t},o?{ssoId:o}:{})}),(e=>F(e))),loadAllSettings:t=>s.transformResponse(e.get(I.settingsAllV2,{queryParams:{tenantId:t}}),(e=>function(e){const s=e.SSOSettings,t=[];return s.forEach((e=>t.push(F(e)))),t}(e)))}),z=e=>({create:(t,o,a,r,n,i,p,m)=>s.transformResponse(e.post(g.create,{name:t,expireTime:o,roleNames:a,keyTenants:r,userId:n,customClaims:i,description:p,permittedIps:m})),load:t=>s.transformResponse(e.get(g.load,{queryParams:{id:t}}),(e=>e.key)),searchAll:t=>s.transformResponse(e.post(g.search,{tenantIds:t}),(e=>e.keys)),update:(t,o,a,r,n,i,p)=>s.transformResponse(e.post(g.update,{id:t,name:o,description:a,roleNames:r,keyTenants:n,customClaims:i,permittedIps:p}),(e=>e.key)),deactivate:t=>s.transformResponse(e.post(g.deactivate,{id:t})),activate:t=>s.transformResponse(e.post(g.activate,{id:t})),delete:t=>s.transformResponse(e.post(g.delete,{id:t}))}),J=e=>({list:()=>s.transformResponse(e.post(S.list,{})),delete:t=>s.transformResponse(e.post(S.delete,{ids:t})),export:t=>s.transformResponse(e.post(S.export,{flowId:t})),import:(t,o,a)=>s.transformResponse(e.post(S.import,{flowId:t,flow:o,screens:a})),run:(t,o)=>s.transformResponse(e.post(S.run,{flowId:t,options:o}),(e=>null==e?void 0:e.output))}),K=e=>({export:()=>s.transformResponse(e.post(T.export,{})),import:t=>s.transformResponse(e.post(T.import,{theme:t}))}),W=e=>({search:t=>{const o=Object.assign(Object.assign({},t),{externalIds:t.loginIds});return delete o.loginIds,s.transformResponse(e.post(j.search,o),(e=>null==e?void 0:e.audits.map((e=>{const s=Object.assign(Object.assign({},e),{occurred:parseFloat(e.occurred),loginIds:e.externalIds});return delete s.externalIds,s}))))},createEvent:t=>{const o=Object.assign({},t);return s.transformResponse(e.post(j.createEvent,o))}}),G=e=>({saveSchema:(t,o)=>s.transformResponse(e.post(N.schemaSave,{schema:t,upgrade:o})),deleteSchema:()=>s.transformResponse(e.post(N.schemaDelete,{})),loadSchema:()=>s.transformResponse(e.post(N.schemaLoad,{}),(e=>e.schema)),saveNamespace:(t,o,a)=>s.transformResponse(e.post(N.nsSave,{namespace:t,oldName:o,schemaName:a})),deleteNamespace:(t,o)=>s.transformResponse(e.post(N.nsDelete,{name:t,schemaName:o})),saveRelationDefinition:(t,o,a,r)=>s.transformResponse(e.post(N.rdSave,{relationDefinition:t,namespace:o,oldName:a,schemaName:r})),deleteRelationDefinition:(t,o,a)=>s.transformResponse(e.post(N.rdDelete,{name:t,namespace:o,schemaName:a})),createRelations:t=>s.transformResponse(e.post(N.reCreate,{relations:t})),deleteRelations:t=>s.transformResponse(e.post(N.reDelete,{relations:t})),deleteRelationsForResources:t=>s.transformResponse(e.post(N.reDeleteResources,{resources:t})),deleteResourceRelationsForResources:t=>s.transformResponse(e.post(N.reDeleteResourceRelationsForResources,{resources:t})),deleteRelationsForIds:t=>s.transformResponse(e.post(N.reDeleteResources,{resources:t})),hasRelations:t=>s.transformResponse(e.post(N.hasRelations,{relationQueries:t}),(e=>e.relationQueries)),whoCanAccess:(t,o,a)=>s.transformResponse(e.post(N.who,{resource:t,relationDefinition:o,namespace:a}),(e=>e.targets)),resourceRelations:(t,o=!1)=>s.transformResponse(e.post(N.resource,{resource:t,ignoreTargetSetRelations:o}),(e=>e.relations)),targetsRelations:(t,o=!1)=>s.transformResponse(e.post(N.targets,{targets:t,includeTargetSetRelations:o}),(e=>e.relations)),whatCanTargetAccess:t=>s.transformResponse(e.post(N.targetAll,{target:t}),(e=>e.relations)),whatCanTargetAccessWithRelation:(t,o,a)=>s.transformResponse(e.post(N.targetWithRelation,{target:t,relationDefinition:o,namespace:a}),(e=>e.resources.map((e=>({resource:e}))))),getModified:t=>s.transformResponse(e.post(N.getModified,{since:t?t.getTime():0}),(e=>e))}),H=e=>({createOidcApplication:t=>{var o;return s.transformResponse(e.post(f.oidcCreate,Object.assign(Object.assign({},t),{enabled:null===(o=t.enabled)||void 0===o||o})))},createSamlApplication:t=>{var o;return s.transformResponse(e.post(f.samlCreate,Object.assign(Object.assign({},t),{enabled:null===(o=t.enabled)||void 0===o||o})))},updateOidcApplication:t=>s.transformResponse(e.post(f.oidcUpdate,Object.assign({},t))),updateSamlApplication:t=>s.transformResponse(e.post(f.samlUpdate,Object.assign({},t))),delete:t=>s.transformResponse(e.post(f.delete,{id:t})),load:t=>s.transformResponse(e.get(f.load,{queryParams:{id:t}}),(e=>e)),loadAll:()=>s.transformResponse(e.get(f.loadAll,{}),(e=>e.apps))}),V=e=>({getSettings:t=>s.transformResponse(e.get(k.settings,{queryParams:{tenantId:t}}),(e=>e)),configureSettings:(t,o)=>s.transformResponse(e.post(k.settings,Object.assign(Object.assign({},o),{tenantId:t})))}),_=(e,t)=>{const o=async(s,o)=>{if((null==t?void 0:t.fgaCacheUrl)&&t.managementKey){const a=`${t.fgaCacheUrl}${s}`;try{const e=new AbortController,s=setTimeout((()=>e.abort()),5e3),r=await i(a,{method:"POST",headers:Object.assign(Object.assign({},t.headers),{"Content-Type":"application/json",Authorization:`Bearer ${t.projectId}:${t.managementKey}`,"x-descope-project-id":t.projectId}),body:JSON.stringify(o),signal:e.signal});return clearTimeout(s),r}catch(t){return e.post(s,o)}}return e.post(s,o)};return{saveSchema:e=>s.transformResponse(o(P.schema,e)),deleteSchema:()=>s.transformResponse(e.post(N.schemaDelete,{})),createRelations:e=>s.transformResponse(o(P.relations,{tuples:e})),deleteRelations:e=>s.transformResponse(o(P.deleteRelations,{tuples:e})),check:e=>s.transformResponse(o(P.check,{tuples:e}),(e=>e.tuples)),loadResourcesDetails:t=>s.transformResponse(e.post(P.resourcesLoad,{resourceIdentifiers:t}),(e=>e.resourcesDetails)),saveResourcesDetails:t=>s.transformResponse(e.post(P.resourcesSave,{resourcesDetails:t})),deleteAllRelations:()=>s.transformResponse(e.delete(P.relations))}},Q=e=>({createApplication:t=>s.transformResponse(e.post(h.create,Object.assign({},t))),updateApplication:t=>s.transformResponse(e.post(h.update,Object.assign({},t))),patchApplication:t=>s.transformResponse(e.post(h.patch,Object.assign({},t))),deleteApplication:t=>s.transformResponse(e.post(h.delete,{id:t})),loadApplication:t=>s.transformResponse(e.get(h.load,{queryParams:{id:t}}),(e=>e)),loadAllApplications:()=>s.transformResponse(e.get(h.loadAll,{}),(e=>e.apps)),getApplicationSecret:t=>s.transformResponse(e.get(h.secret,{queryParams:{id:t}}),(e=>e)),rotateApplicationSecret:t=>s.transformResponse(e.post(h.rotate,{id:t})),searchConsents:t=>s.transformResponse(e.post(R.search,Object.assign({},t)),(e=>e.consents)),deleteConsents:t=>s.transformResponse(e.post(R.delete,Object.assign({},t)))}),X=e=>({createApplication:t=>s.transformResponse(e.post(y.create,Object.assign({},t)),(e=>e.app)),updateApplication:t=>s.transformResponse(e.post(y.update,{app:t}),(e=>e.app)),deleteApplication:t=>s.transformResponse(e.post(y.delete,{id:t})),loadApplication:t=>s.transformResponse(e.get(`${y.load}/${t}`),(e=>e.app)),loadAllApplications:()=>s.transformResponse(e.get(y.loadAll,{}),(e=>e.apps)),fetchTokenByScopes:(t,o,a,r,n)=>s.transformResponse(e.post(y.fetchTokenByScopes,{appId:t,userId:o,scopes:a,options:r,tenantId:n}),(e=>e.token)),fetchToken:(t,o,a,r)=>s.transformResponse(e.post(y.fetchToken,{appId:t,userId:o,tenantId:a,options:r}),(e=>e.token)),fetchTenantTokenByScopes:(t,o,a,r)=>s.transformResponse(e.post(y.fetchTenantTokenByScopes,{appId:t,tenantId:o,scopes:a,options:r}),(e=>e.token)),fetchTenantToken:(t,o,a)=>s.transformResponse(e.post(y.fetchTenantToken,{appId:t,tenantId:o,options:a}),(e=>e.token)),deleteUserTokens:(t,o)=>s.transformResponse(e.delete(y.deleteUserTokens,{queryParams:{appId:t,userId:o}})),deleteTokenById:t=>s.transformResponse(e.delete(y.deleteTokenById,{queryParams:{id:t}}))}),Y=e=>({create:t=>s.transformResponse(e.put(U.create,{descopers:t}),(e=>({descopers:e.descopers,total:e.total}))),update:(t,o,a)=>s.transformResponse(e.patch(U.update,{id:t,attributes:o,rbac:a}),(e=>e.descoper)),load:t=>s.transformResponse(e.get(U.get,{queryParams:{id:t}}),(e=>e.descoper)),delete:t=>s.transformResponse(e.delete(U.delete,{queryParams:{id:t}})),list:()=>s.transformResponse(e.post(U.list),(e=>({descopers:e.descopers,total:e.total})))}),Z=e=>({create:(t,o,a,r,n)=>s.transformResponse(e.put(E.create,{name:t,description:a,expiresIn:r,permittedIps:n,reBac:o})),update:(t,o,a,r,n)=>s.transformResponse(e.patch(E.update,{id:t,name:o,description:a,permittedIps:n,status:r}),(e=>e.key)),delete:t=>s.transformResponse(e.post(E.delete,{ids:t})),load:t=>s.transformResponse(e.get(E.load,{queryParams:{id:t}}),(e=>e.key)),search:()=>s.transformResponse(e.get(E.search),(e=>e.keys))});const ee=o=>{var a,n,c,{authManagementKey:g,managementKey:v,publicKey:f,fgaCacheUrl:h}=o,R=e.__rest(o,["authManagementKey","managementKey","publicKey","fgaCacheUrl"]);const y={"x-descope-sdk-name":"nodejs","x-descope-sdk-node-version":(null===(a=null===process||void 0===process?void 0:process.versions)||void 0===a?void 0:a.node)||"","x-descope-sdk-version":"1.9.1"},I=Object.assign(Object.assign({fetch:i},R),{baseHeaders:Object.assign(Object.assign({},R.baseHeaders),y),hooks:Object.assign(Object.assign({},R.hooks),{beforeRequest:[e=>(g&&(e.token=e.token?`${e.token}:${g}`:g),e)].concat((null===(n=R.hooks)||void 0===n?void 0:n.beforeRequest)||[])})}),b=r.default(I),{projectId:k,logger:A}=R,O={},S=Object.assign(Object.assign({fetch:i},R),{baseConfig:{baseHeaders:Object.assign(Object.assign({},R.baseHeaders),y)},hooks:Object.assign(Object.assign({},R.hooks),{beforeRequest:[e=>(e.token=v,e)].concat((null===(c=R.hooks)||void 0===c?void 0:c.beforeRequest)||[])})}),T=s.createHttpClient(S),w=(N={fgaCacheUrl:h,managementKey:v,projectId:k,headers:y},{user:x(j=T),project:(P=j,{updateName:e=>s.transformResponse(P.post(u.updateName,{name:e})),updateTags:e=>s.transformResponse(P.post(u.updateTags,{tags:e})),clone:(e,t,o)=>s.transformResponse(P.post(u.clone,{name:e,environment:t,tags:o})),listProjects:async()=>s.transformResponse(P.post(u.projectsList,{}),(e=>e.projects.map((({id:e,name:s,environment:t,tags:o})=>({id:e,name:s,environment:t,tags:o}))))),exportSnapshot:()=>s.transformResponse(P.post(u.exportSnapshot,{})),importSnapshot:e=>s.transformResponse(P.post(u.importSnapshot,e)),validateSnapshot:e=>s.transformResponse(P.post(u.validateSnapshot,e)),export:()=>s.transformResponse(P.post(u.exportSnapshot,{}),(e=>e.files)),import:e=>s.transformResponse(P.post(u.importSnapshot,{files:e}))}),accessKey:z(j),tenant:C(j),ssoApplication:H(j),inboundApplication:Q(j),outboundApplication:X(j),sso:$(j),jwt:D(j),permission:L(j),password:V(j),role:q(j),group:B(j),flow:J(j),theme:K(j),audit:W(j),authz:G(j),fga:_(j,N),descoper:Y(j),managementKey:Z(j)});var j,N,P;const U=Object.assign(Object.assign({},b),{refresh:async(e,s)=>b.refresh(e,void 0,s),management:w,async getKey(e){if(!(null==e?void 0:e.kid))throw Error("header.kid must not be empty");if(O[e.kid])return O[e.kid];if(Object.assign(O,await(async()=>{if(f)try{const e=JSON.parse(f),s=await t.importJWK(e);return{[e.kid]:s}}catch(e){throw null==A||A.error("Failed to parse the provided public key",e),new Error(`Failed to parse public key. Error: ${e}`)}const e=(await b.httpClient.get(`v2/keys/${k}`).then((e=>e.json()))).keys;return Array.isArray(e)?(await Promise.all(e.map((async e=>[e.kid,await t.importJWK(e)])))).reduce(((e,[s,t])=>s?Object.assign(Object.assign({},e),{[s.toString()]:t}):e),{}):{}})()),!O[e.kid])throw Error("failed to fetch matching key");return O[e.kid]},async validateJwt(e,s){var o;const a={clockTolerance:5};(null==s?void 0:s.audience)&&(a.audience=s.audience);const r=(await t.jwtVerify(e,U.getKey,a)).payload;if(r&&(r.iss=null===(o=r.iss)||void 0===o?void 0:o.split("/").pop(),r.iss!==k))throw new t.errors.JWTClaimValidationFailed('unexpected "iss" claim value',"iss","check_failed");return{jwt:e,token:r}},async validateSession(e,s){if(!e)throw Error("session token is required for validation");try{return await U.validateJwt(e,s)}catch(e){throw null==A||A.error("session validation failed",e),Error(`session validation failed. Error: ${e}`)}},async refreshSession(e,s){var t,o,a,r,n,i;if(!e)throw Error("refresh token is required to refresh a session");try{await U.validateJwt(e);const m=await U.refresh(e);if(m.ok){const e=p(null===(o=null===(t=m.data)||void 0===t?void 0:t.cookies)||void 0===o?void 0:o.join(";"),"DS")||(null===(a=m.data)||void 0===a?void 0:a.sessionJwt),i=await U.validateJwt(e,s);return i.cookies=(null===(r=m.data)||void 0===r?void 0:r.cookies)||[],(null===(n=m.data)||void 0===n?void 0:n.refreshJwt)&&(i.refreshJwt=m.data.refreshJwt),i}throw Error(null===(i=m.error)||void 0===i?void 0:i.errorMessage)}catch(e){throw null==A||A.error("refresh token validation failed",e),Error(`refresh token validation failed, Error: ${e}`)}},async validateAndRefreshSession(e,s,t){if(!e&&!s)throw Error("both session and refresh tokens are empty");try{return await U.validateSession(e,t)}catch(e){null==A||A.log(`session validation failed with error ${e} - trying to refresh it`)}return U.refreshSession(s,t)},async exchangeAccessKey(e,s,t){var o;if(!e)throw Error("access key must not be empty");let a;try{a=await U.accessKey.exchange(e,s)}catch(e){throw null==A||A.error("failed to exchange access key",e),Error(`could not exchange access key - Failed to exchange. Error: ${e}`)}if(!a.ok)throw null==A||A.error("failed to exchange access key",a.error),Error(`could not exchange access key - ${null===(o=a.error)||void 0===o?void 0:o.errorMessage}`);const{sessionJwt:r}=a.data;if(!r)throw null==A||A.error("failed to parse exchange access key response"),Error("could not exchange access key");try{return await U.validateJwt(r,t)}catch(e){throw null==A||A.error("failed to parse jwt from access key",e),Error(`could not exchange access key - failed to validate jwt. Error: ${e}`)}},validatePermissions:(e,s)=>U.validateTenantPermissions(e,"",s),getMatchedPermissions:(e,s)=>U.getMatchedTenantPermissions(e,"",s),validateTenantPermissions(e,s,t){if(s&&!l(e,s))return!1;const o=d(e,"permissions",s);return t.every((e=>o.includes(e)))},getMatchedTenantPermissions(e,s,t){if(s&&!l(e,s))return[];const o=d(e,"permissions",s);return t.filter((e=>o.includes(e)))},validateRoles:(e,s)=>U.validateTenantRoles(e,"",s),getMatchedRoles:(e,s)=>U.getMatchedTenantRoles(e,"",s),validateTenantRoles(e,s,t){if(s&&!l(e,s))return!1;const o=d(e,"roles",s);return t.every((e=>o.includes(e)))},getMatchedTenantRoles(e,s,t){if(s&&!l(e,s))return[];const o=d(e,"roles",s);return t.filter((e=>o.includes(e)))}});return s.wrapWith(U,["otp.verify.email","otp.verify.sms","otp.verify.voice","otp.verify.whatsapp","otp.verify.im","magicLink.verify","enchantedLink.signUp","enchantedLink.signIn","oauth.exchange","saml.exchange","totp.verify","webauthn.signIn.finish","webauthn.signUp.finish","refresh"],m)};ee.RefreshTokenCookieName="DSR",ee.SessionTokenCookieName="DS",ee.DescopeErrors={badRequest:"E011001",missingArguments:"E011002",invalidRequest:"E011003",invalidArguments:"E011004",wrongOTPCode:"E061102",tooManyOTPAttempts:"E061103",enchantedLinkPending:"E062503",userNotFound:"E062108"},module.exports=ee;
//# sourceMappingURL=index.cjs.js.map
